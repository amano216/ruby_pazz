<!DOCTYPE html>
<html>
<head>
  <title>Critical Issues Test</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .issue { margin: 20px 0; padding: 15px; border: 2px solid #f00; background: #fee; }
    .passed { border-color: #0a0; background: #efe; }
    .title { font-weight: bold; font-size: 1.2em; }
    pre { background: #fff; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>ğŸ”´ JavaScript Ruby ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ é‡å¤§å•é¡Œãƒ†ã‚¹ãƒˆ</h1>
  <div id="results"></div>
  
  <script src="app.js"></script>
  <script>
    const interpreter = new RubyInterpreter();
    const results = document.getElementById('results');
    
    const criticalTests = [
      {
        title: "æ¼”ç®—å­ã®å„ªå…ˆé †ä½",
        code: 'puts 2 + 3 * 4',
        expected: "14\n",  // Ruby: 2 + (3 * 4) = 14
        issue: "ä¹—ç®—ãŒåŠ ç®—ã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹ã¹ã"
      },
      {
        title: "æ‹¬å¼§ä»˜ãæ¼”ç®—",
        code: 'puts (2 + 3) * 4',
        expected: "20\n",
        issue: "æ‹¬å¼§å†…ãŒå…ˆã«è©•ä¾¡ã•ã‚Œã‚‹ã¹ã"
      },
      {
        title: "nil ãƒã‚§ãƒƒã‚¯",
        code: 'x = nil\nputs x.nil?',
        expected: "true\n",
        issue: "nilã«å¯¾ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—"
      },
      {
        title: "0é™¤ç®—ã‚¨ãƒ©ãƒ¼",
        code: 'puts 10 / 0',
        shouldError: true,
        issue: "0é™¤ç®—ã§ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™ã¹ã"
      },
      {
        title: "é…åˆ—ã®ç¯„å›²å¤–ã‚¢ã‚¯ã‚»ã‚¹",
        code: 'arr = [1, 2, 3]\nputs arr[10]',
        expected: "\n",  // Rubyã§ã¯nilã‚’è¿”ã™ï¼ˆputsã§nilã¯ç©ºè¡Œï¼‰
        issue: "ç¯„å›²å¤–ã¯nilã‚’è¿”ã™ã¹ã"
      },
      {
        title: "æ–‡å­—åˆ—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—",
        code: 'puts "hello\\nworld"',
        expected: "hello\nworld\n",
        issue: "\\nãŒæ”¹è¡Œã«å¤‰æ›ã•ã‚Œã‚‹ã¹ã"
      },
      {
        title: "æ•´æ•°é™¤ç®—",
        code: 'puts 5 / 2',
        expected: "2\n",
        issue: "æ•´æ•°åŒå£«ã®é™¤ç®—ã¯æ•´æ•°ã‚’è¿”ã™ã¹ã"
      },
      {
        title: "è¤‡é›‘ãªãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³",
        code: 'puts "hello".upcase.reverse.length',
        expected: "5\n",
        issue: "ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ãŒæ­£ã—ãå‹•ä½œã™ã¹ã"
      },
      {
        title: "ãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã®å¤‰æ•°ã‚¹ã‚³ãƒ¼ãƒ—",
        code: 'x = 0\n3.times do\n  x += 1\nend\nputs x',
        expected: "3\n",
        issue: "ãƒ–ãƒ­ãƒƒã‚¯å†…ã§å¤–å´ã®å¤‰æ•°ã‚’å¤‰æ›´ã§ãã‚‹ã¹ã"
      },
      {
        title: "any?ãƒ¡ã‚½ãƒƒãƒ‰ã®æ­£ã—ã„å®Ÿè£…",
        code: 'puts [1, 3, 5].any? { |n| n.even? }',
        expected: "false\n",
        issue: "any?ã¯ãƒ–ãƒ­ãƒƒã‚¯ã®æ¡ä»¶ã‚’è©•ä¾¡ã™ã¹ã"
      },
      {
        title: "all?ãƒ¡ã‚½ãƒƒãƒ‰ã®æ­£ã—ã„å®Ÿè£…",
        code: 'puts [2, 4, 6].all? { |n| n.even? }',
        expected: "true\n",
        issue: "all?ã¯ãƒ–ãƒ­ãƒƒã‚¯ã®æ¡ä»¶ã‚’è©•ä¾¡ã™ã¹ã"
      },
      {
        title: "å¾Œç½®if",
        code: 'puts "hello" if true',
        expected: "hello\n",
        issue: "å¾Œç½®ifãŒå‹•ä½œã™ã¹ã"
      },
      {
        title: "case whenæ–‡",
        code: 'x = 2\ncase x\nwhen 1\n  puts "one"\nwhen 2\n  puts "two"\nelse\n  puts "other"\nend',
        expected: "two\n",
        issue: "case whenæ–‡ãŒå‹•ä½œã™ã¹ã"
      },
      {
        title: "æ­£è¦è¡¨ç¾ãƒãƒƒãƒ",
        code: 'puts "hello" =~ /ell/',
        expected: "1\n",
        issue: "æ­£è¦è¡¨ç¾ãƒãƒƒãƒãŒå‹•ä½œã™ã¹ã"
      },
      {
        title: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°",
        code: 'def greet(name = "World")\n  puts "Hello #{name}"\nend\ngreet()',
        expected: "Hello World\n",
        issue: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ãŒå‹•ä½œã™ã¹ã"
      }
    ];
    
    criticalTests.forEach(test => {
      const div = document.createElement('div');
      
      try {
        interpreter.reset();
        const result = interpreter.execute(test.code);
        
        if (test.shouldError) {
          div.className = 'issue';
          div.innerHTML = `
            <div class="title">âŒ ${test.title}</div>
            <div>å•é¡Œ: ${test.issue}</div>
            <pre>ã‚³ãƒ¼ãƒ‰:\n${test.code}</pre>
            <pre>æœŸå¾…: ã‚¨ãƒ©ãƒ¼\nå®Ÿéš›: ${JSON.stringify(result)}</pre>
          `;
        } else {
          const passed = result === test.expected;
          div.className = passed ? 'issue passed' : 'issue';
          div.innerHTML = `
            <div class="title">${passed ? 'âœ…' : 'âŒ'} ${test.title}</div>
            <div>å•é¡Œ: ${test.issue}</div>
            <pre>ã‚³ãƒ¼ãƒ‰:\n${test.code}</pre>
            <pre>æœŸå¾…: ${JSON.stringify(test.expected)}\nå®Ÿéš›: ${JSON.stringify(result)}</pre>
          `;
        }
      } catch (error) {
        if (test.shouldError) {
          div.className = 'issue passed';
          div.innerHTML = `
            <div class="title">âœ… ${test.title}</div>
            <div>å•é¡Œ: ${test.issue}</div>
            <pre>ã‚³ãƒ¼ãƒ‰:\n${test.code}</pre>
            <pre>æ­£ã—ãã‚¨ãƒ©ãƒ¼: ${error.message}</pre>
          `;
        } else {
          div.className = 'issue';
          div.innerHTML = `
            <div class="title">âŒ ${test.title}</div>
            <div>å•é¡Œ: ${test.issue}</div>
            <pre>ã‚³ãƒ¼ãƒ‰:\n${test.code}</pre>
            <pre>äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${error.message}</pre>
          `;
        }
      }
      
      results.appendChild(div);
    });
    
    // çµ±è¨ˆã‚’è¡¨ç¤º
    const passed = document.querySelectorAll('.passed').length;
    const total = criticalTests.length;
    const summary = document.createElement('div');
    summary.style.marginTop = '30px';
    summary.style.padding = '20px';
    summary.style.background = '#333';
    summary.style.color = '#fff';
    summary.innerHTML = `
      <h2>ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
      <p>åˆæ ¼: ${passed}/${total} (${Math.round(passed/total*100)}%)</p>
      <p>ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã¯åŸºæœ¬çš„ãªæ•™è‚²ç”¨é€”ã«ã¯é©ã—ã¦ã„ã¾ã™ãŒã€</p>
      <p>å®Ÿéš›ã®Rubyã®ä»•æ§˜ã®ç´„30%ç¨‹åº¦ã—ã‹ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
    `;
    results.appendChild(summary);
  </script>
</body>
</html>