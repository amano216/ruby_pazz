<!DOCTYPE html>
<html>
<head>
  <title>Test Undefined Variable</title>
</head>
<body>
  <h1>Test Undefined Variable Error</h1>
  <div id="results"></div>
  
  <script src="app.js"></script>
  <script>
    const interpreter = new RubyInterpreter();
    const results = document.getElementById('results');
    
    const tests = [
      {
        name: "Undefined variable 'five'",
        code: 'x = 5\nif x == 5\n  puts five\nend',
        shouldError: true
      },
      {
        name: "Correct with string",
        code: 'x = 5\nif x == 5\n  puts "five"\nend',
        shouldError: false,
        expected: "five\n"
      },
      {
        name: "Defined variable",
        code: 'five = "5"\nx = 5\nif x == 5\n  puts five\nend',
        shouldError: false,
        expected: "5\n"
      },
      {
        name: "Undefined variable in expression",
        code: 'puts unknown_var',
        shouldError: true
      },
      {
        name: "Defined variable in expression",
        code: 'name = "Ruby"\nputs name',
        shouldError: false,
        expected: "Ruby\n"
      }
    ];
    
    tests.forEach(test => {
      try {
        interpreter.reset();
        const result = interpreter.execute(test.code);
        
        if (test.shouldError) {
          results.innerHTML += `
            <div style="margin: 10px; padding: 10px; border: 1px solid red">
              <h3>${test.name}: ❌ FAILED (should have errored)</h3>
              <pre>Code: ${test.code}</pre>
              <pre>Got result: ${result}</pre>
            </div>
          `;
        } else {
          const passed = result === test.expected;
          results.innerHTML += `
            <div style="margin: 10px; padding: 10px; border: 1px solid ${passed ? 'green' : 'orange'}">
              <h3>${test.name}: ${passed ? '✅ PASSED' : '⚠️ WRONG OUTPUT'}</h3>
              <pre>Code: ${test.code}</pre>
              <pre>Expected: ${JSON.stringify(test.expected)}</pre>
              <pre>Got: ${JSON.stringify(result)}</pre>
            </div>
          `;
        }
      } catch (error) {
        if (test.shouldError) {
          results.innerHTML += `
            <div style="margin: 10px; padding: 10px; border: 1px solid green">
              <h3>${test.name}: ✅ PASSED (correctly errored)</h3>
              <pre>Code: ${test.code}</pre>
              <pre>Error: ${error.message}</pre>
            </div>
          `;
        } else {
          results.innerHTML += `
            <div style="margin: 10px; padding: 10px; border: 1px solid red">
              <h3>${test.name}: ❌ FAILED (unexpected error)</h3>
              <pre>Code: ${test.code}</pre>
              <pre>Error: ${error.message}</pre>
            </div>
          `;
        }
      }
    });
  </script>
</body>
</html>