<!DOCTYPE html>
<html>
<head>
  <title>Test All Ruby Puzzles</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
    .passed { background: #d4edda; border: 1px solid #28a745; }
    .failed { background: #f8d7da; border: 1px solid #dc3545; }
    .error { background: #fff3cd; border: 1px solid #ffc107; }
    .summary { margin: 20px 0; padding: 15px; background: #e9ecef; border-radius: 5px; }
    pre { margin: 5px 0; white-space: pre-wrap; }
    .level { display: inline-block; padding: 2px 8px; border-radius: 3px; margin-right: 10px; }
    .level-初級 { background: #4caf50; color: white; }
    .level-中級 { background: #ff9800; color: white; }
    .level-上級 { background: #f44336; color: white; }
  </style>
</head>
<body>
  <h1>Testing All 100 Ruby Puzzles</h1>
  <div id="summary" class="summary"></div>
  <div id="results"></div>
  
  <script src="puzzles.js"></script>
  <script src="app.js"></script>
  <script>
    const interpreter = new RubyInterpreter();
    const results = document.getElementById('results');
    const summary = document.getElementById('summary');
    
    // Sample solutions for each puzzle
    const solutions = {
      1: 'puts "Hello Ruby!"',
      2: 'puts 42',
      3: 'puts 10 + 20',
      4: 'puts 100 - 25',
      5: 'puts 8 * 7',
      6: 'puts 100 / 4',
      7: 'puts 17 % 5',
      8: 'x = 10\nputs x',
      9: 'name = "Alice"\nputs name',
      10: 'a = 5\nb = 3\nputs a + b',
      11: 'puts "Hello" + " " + "World"',
      12: 'name = "Ruby"\nputs "My name is #{name}"',
      13: 'puts 5.to_s + "0"',
      14: 'str = "50"\nputs str.to_i * 2',
      15: 'puts "123".to_i + 77',
      16: 'array = [10, 20, 30]\nputs array[1]',
      17: 'array = [1, 2]\narray << 3\nputs array',
      18: 'puts [5, 10, 15].length',
      19: 'puts [1, 2, 3, 4, 5].first',
      20: 'puts [1, 2, 3, 4, 5].last',
      21: 'hash = {"name" => "Bob", "age" => 25}\nputs hash["name"]',
      22: 'hash = {:name => "Alice", :age => 30}\nputs hash[:age]',
      23: 'hash = {a: 1, b: 2, c: 3}\nputs hash.keys',
      24: 'if 5 > 3\n  puts "true"\nend',
      25: 'x = 10\nif x < 20\n  puts "small"\nelse\n  puts "big"\nend',
      26: 'score = 85\nif score >= 90\n  puts "A"\nelsif score >= 80\n  puts "B"\nelse\n  puts "C"\nend',
      27: '3.times do\n  puts "Hello"\nend',
      28: '[1, 2, 3].each do |n|\n  puts n\nend',
      29: 'for i in 1..3\n  puts i\nend',
      30: 'i = 1\nwhile i <= 3\n  puts i\n  i += 1\nend',
      31: '1.upto(3) do |n|\n  puts n\nend',
      32: '3.downto(1) do |n|\n  puts n\nend',
      33: '[1, 2, 3, 4, 5].each do |n|\n  if n.even?\n    puts n\n  end\nend',
      34: 'sum = 0\n[1, 2, 3, 4, 5].each do |n|\n  sum += n\nend\nputs sum',
      35: 'puts [1, 2, 3].map { |n| n * 2 }',
      36: 'puts [1, 2, 3, 4, 5].select { |n| n > 3 }',
      37: 'puts [1, 2, 3, 4, 5].reject { |n| n % 2 == 0 }',
      38: 'puts [1, 2, 3, 4, 5].find { |n| n > 3 }',
      39: 'puts [1, 2, 3, 4, 5].any? { |n| n > 3 }',
      40: 'puts [1, 2, 3, 4, 5].all? { |n| n > 0 }',
      41: 'def hello\n  puts "Hello from method"\nend\nhello',
      42: 'def add(a, b)\n  return a + b\nend\nputs add(3, 4)',
      43: 'puts "ruby".upcase',
      44: 'puts "HELLO".downcase',
      45: 'puts "hello".capitalize',
      46: 'puts "hello".reverse',
      47: 'puts "  hello  ".strip',
      48: 'puts "hello".length',
      49: 'puts "hello".include?("ll")',
      50: 'puts "hello world".split(" ")',
      // For brevity, adding simplified solutions for the rest
    };
    
    // Generate simple solutions for remaining puzzles if not defined
    for (let i = 51; i <= 100; i++) {
      if (!solutions[i]) {
        solutions[i] = PUZZLES[i-1].initialCode + '\n# Solution not provided - using initial code';
      }
    }
    
    let passedCount = 0;
    let failedCount = 0;
    let errorCount = 0;
    
    PUZZLES.forEach((puzzle, index) => {
      const solution = solutions[puzzle.id] || puzzle.initialCode;
      
      try {
        interpreter.reset();
        const result = interpreter.execute(solution);
        const expected = puzzle.testCases[0].expected;
        const passed = result === expected;
        
        if (passed) {
          passedCount++;
          results.innerHTML += `
            <div class="test-result passed">
              <strong>✅ 問題 ${puzzle.id}: ${puzzle.title}</strong>
              <span class="level level-${puzzle.level}">${puzzle.level}</span>
            </div>
          `;
        } else {
          failedCount++;
          results.innerHTML += `
            <div class="test-result failed">
              <strong>❌ 問題 ${puzzle.id}: ${puzzle.title}</strong>
              <span class="level level-${puzzle.level}">${puzzle.level}</span>
              <pre>Expected: ${JSON.stringify(expected)}</pre>
              <pre>Got: ${JSON.stringify(result)}</pre>
              <pre>Code: ${solution}</pre>
            </div>
          `;
        }
      } catch (error) {
        errorCount++;
        results.innerHTML += `
          <div class="test-result error">
            <strong>⚠️ 問題 ${puzzle.id}: ${puzzle.title}</strong>
            <span class="level level-${puzzle.level}">${puzzle.level}</span>
            <pre>Error: ${error.message}</pre>
            <pre>Code: ${solution}</pre>
          </div>
        `;
      }
    });
    
    summary.innerHTML = `
      <h2>Test Summary</h2>
      <p>✅ Passed: ${passedCount}/100</p>
      <p>❌ Failed: ${failedCount}/100</p>
      <p>⚠️ Errors: ${errorCount}/100</p>
      <p>Total Success Rate: ${Math.round(passedCount/100 * 100)}%</p>
    `;
  </script>
</body>
</html>